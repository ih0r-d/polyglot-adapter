name: ğŸš€ Maven Library Release

on:
  push:
    tags:
      - "v*"

permissions:
  contents: write
  packages: write

jobs:
  release:
    runs-on: ubuntu-latest

    steps:
      - name: ğŸ§© Checkout repo
        uses: actions/checkout@v4

      - name: â˜• Setup JDK 25 (Temurin)
        uses: actions/setup-java@v4
        with:
          distribution: temurin
          java-version: 25
          cache: maven

      - name: âš™ï¸ Install Task CLI (Taskfile.dev)
        run: |
          echo "ğŸ›  Installing Task CLI..."
          sh -c "$(curl --location https://taskfile.dev/install.sh)" -- -d
          sudo mv ./bin/task /usr/local/bin/task
          task --version

      - name: ğŸ”§ Build project
        run: task build

      - name: ğŸ§ª Run tests
        run: task test

      - name: ğŸ“¦ Collect JAR artifacts
        run: |
          mkdir -p release-artifacts
          find . -type f -name "*.jar" ! -name "original-*.jar" -exec cp {} release-artifacts/ \;
          ls -la release-artifacts

      - name: ğŸ·ï¸ Create GitHub Release
        uses: ncipollo/release-action@v1
        with:
          tag: ${{ github.ref_name }}
          name: Release ${{ github.ref_name }}
          artifacts: "release-artifacts/*.jar"
          artifactContentType: application/java-archive
          body: |
            ğŸš€ **Maven Library Release**  
            Built automatically from tag `${{ github.ref_name }}`  
            âœ… Includes compiled JAR artifacts.
          token: ${{ secrets.GITHUB_TOKEN }}
